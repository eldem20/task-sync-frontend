import './Header.css';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import { useMediaQuery } from 'react-responsive';

interface HeaderProps {
  title?: string;
  showBackButton?: boolean;
}

const Header = ({ title, showBackButton = false }: HeaderProps) => {
  const navigate = useNavigate();
  const { user } = useAuth();
  const isDesktop = useMediaQuery({ minWidth: 768 });

  const handleBackClick = () => {
    navigate(-1);
  };

  const getInitial = () => {
    if (user?.name) {
      return user.name.charAt(0).toUpperCase();
    }
    return 'U';
  };

  if (isDesktop && showBackButton && title) {
    return (
      <div className="header-desktop-with-back">
        <div className="desktop-header-content">
          {/* Стрелка сверху */}
          <div className="desktop-back-top">
            <button className="back-button-desktop" onClick={handleBackClick}>
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.9414 6C11.2588 6 11.5625 6.0734 11.8516 6.21875C12.2126 6.42253 12.5009 6.7451 12.6602 7.12402C12.7614 7.38607 12.9202 8.1696 12.9209 8.1875C13.0669 8.98161 13.1509 10.2352 13.1631 11.6396L13.165 11.9932C13.165 13.4648 13.079 14.807 12.9492 15.6816L12.835 16.2256C12.7717 16.5135 12.6892 16.8414 12.6025 17.0088C12.2852 17.6211 11.6642 17.9998 11 18H10.9414C10.5102 17.9856 9.60702 17.6093 9.59863 17.5928C8.13464 16.9785 5.31031 15.1244 4.00586 13.8027L3.62695 13.4062C3.52776 13.2988 3.41593 13.1714 3.34668 13.0723C3.11543 12.7661 3.00002 12.3867 3 12.0078C3 11.585 3.1297 11.1917 3.375 10.8701L3.76465 10.4492L3.85156 10.3594C5.03521 9.0761 8.12647 6.97812 9.74316 6.33594L9.9873 6.24219C10.2809 6.13698 10.692 6.01165 10.9414 6ZM19.4971 10.4824C20.3269 10.4826 20.9998 11.1621 21 12C21 12.8382 20.3271 13.5184 19.4971 13.5186L15.7979 13.1914C15.1466 13.1914 14.6182 12.6576 14.6182 12C14.6184 11.3415 15.1467 10.8096 15.7979 10.8096L19.4971 10.4824Z" fill="#24252C" />
              </svg>
            </button>
          </div>

          {/* Название страницы снизу */}
          <div className="desktop-title-below">
            <h1 className="page-title-desktop">{title}</h1>
          </div>
        </div>

        {/* Иконка уведомлений справа */}
        <div className="desktop-notifications-right">
          <div className="notifications">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.34 14.49L18.34 12.83C18.13 12.46 17.94 11.76 17.94 11.35V8.82C17.94 6.47 16.56 4.44 14.57 3.49C14.05 2.57 13.09 2 11.99 2C10.9 2 9.92 2.59 9.4 3.52C7.45 4.49 6.1 6.5 6.1 8.82V11.35C6.1 11.76 5.91 12.46 5.7 12.82L4.69 14.49C4.29 15.16 4.2 15.9 4.45 16.58C4.69 17.25 5.26 17.77 6 18.02C7.94 18.68 9.98 19 12.02 19C14.06 19 16.1 18.68 18.04 18.03C18.74 17.8 19.28 17.27 19.54 16.58C19.8 15.89 19.73 15.13 19.34 14.49Z" fill="#24252C" />
              <path d="M14.83 20.01C14.41 21.17 13.3 22 12 22C11.21 22 10.43 21.68 9.87999 21.11C9.55999 20.81 9.31999 20.41 9.17999 20C9.30999 20.02 9.43999 20.03 9.57999 20.05C9.80999 20.08 10.05 20.11 10.29 20.13C10.86 20.18 11.44 20.21 12.02 20.21C12.59 20.21 13.16 20.18 13.72 20.13C13.93 20.11 14.14 20.1 14.34 20.07C14.5 20.05 14.66 20.03 14.83 20.01Z" fill="#24252C" />
              <circle cx="17" cy="4" r="4" fill="#5F33E1" />
            </svg>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="header">
      <div className="header-left">
        {showBackButton ? (
          <button className="back-button" onClick={handleBackClick}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.9414 6C11.2588 6 11.5625 6.0734 11.8516 6.21875C12.2126 6.42253 12.5009 6.7451 12.6602 7.12402C12.7614 7.38607 12.9202 8.1696 12.9209 8.1875C13.0669 8.98161 13.1509 10.2352 13.1631 11.6396L13.165 11.9932C13.165 13.4648 13.079 14.807 12.9492 15.6816L12.835 16.2256C12.7717 16.5135 12.6892 16.8414 12.6025 17.0088C12.2852 17.6211 11.6642 17.9998 11 18H10.9414C10.5102 17.9856 9.60702 17.6093 9.59863 17.5928C8.13464 16.9785 5.31031 15.1244 4.00586 13.8027L3.62695 13.4062C3.52776 13.2988 3.41593 13.1714 3.34668 13.0723C3.11543 12.7661 3.00002 12.3867 3 12.0078C3 11.585 3.1297 11.1917 3.375 10.8701L3.76465 10.4492L3.85156 10.3594C5.03521 9.0761 8.12647 6.97812 9.74316 6.33594L9.9873 6.24219C10.2809 6.13698 10.692 6.01165 10.9414 6ZM19.4971 10.4824C20.3269 10.4826 20.9998 11.1621 21 12C21 12.8382 20.3271 13.5184 19.4971 13.5186L15.7979 13.1914C15.1466 13.1914 14.6182 12.6576 14.6182 12C14.6184 11.3415 15.1467 10.8096 15.7979 10.8096L19.4971 10.4824Z" fill="#24252C" />
            </svg>
          </button>
        ) : (
          <div className="avatar-circle">
            {user ? (
              <span className="avatar-initial">{getInitial()}</span>
            ) : (
              <img src="/header.jpg" alt="" className="avatar" />
            )}
          </div>
        )}
      </div>

      <div className="header-center">
        {title ? (
          <h1 className="page-title">{title}</h1>
        ) : (
          <h1 className="welcText">
            Hello! <br />
            {user?.name || 'Guest'}
          </h1>
        )}
      </div>

      <div className="header-right">
        <div className="notifications">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.34 14.49L18.34 12.83C18.13 12.46 17.94 11.76 17.94 11.35V8.82C17.94 6.47 16.56 4.44 14.57 3.49C14.05 2.57 13.09 2 11.99 2C10.9 2 9.92 2.59 9.4 3.52C7.45 4.49 6.1 6.5 6.1 8.82V11.35C6.1 11.76 5.91 12.46 5.7 12.82L4.69 14.49C4.29 15.16 4.2 15.9 4.45 16.58C4.69 17.25 5.26 17.77 6 18.02C7.94 18.68 9.98 19 12.02 19C14.06 19 16.1 18.68 18.04 18.03C18.74 17.8 19.28 17.27 19.54 16.58C19.8 15.89 19.73 15.13 19.34 14.49Z" fill="#24252C" />
            <path d="M14.83 20.01C14.41 21.17 13.3 22 12 22C11.21 22 10.43 21.68 9.87999 21.11C9.55999 20.81 9.31999 20.41 9.17999 20C9.30999 20.02 9.43999 20.03 9.57999 20.05C9.80999 20.08 10.05 20.11 10.29 20.13C10.86 20.18 11.44 20.21 12.02 20.21C12.59 20.21 13.16 20.18 13.72 20.13C13.93 20.11 14.14 20.1 14.34 20.07C14.5 20.05 14.66 20.03 14.83 20.01Z" fill="#24252C" />
            <circle cx="17" cy="4" r="4" fill="#5F33E1" />
          </svg>
        </div>
      </div>
    </div>
  );
};

export default Header;